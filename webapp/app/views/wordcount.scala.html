@(wsUrl: String)

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Word Count</title>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.11.2/lodash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.5.2/redux.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-with-addons.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/4.4.5/react-redux.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.js" type="text/javascript"></script>


        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

        </style>
    </head>
    <body>
        @*<div id="app">*@
            @*Twitter Word Counts*@

            @*<div>*@
                @*<table style="table-layout: auto">*@
                    @*<th>Word</th>*@
                    @*<th>Count</th>*@
                    @*<tr v-for="word in wordcounts">*@

                        @*<td>{{word.key}}</td>*@
                        @*<td>{{word.val}}</td>*@

                    @*</tr>*@
                @*</table>*@
            @*</div>*@
        @*</div>*@

        <script type="text/babel">
            /* IMPORTS */
          const {connect, Provider} = ReactRedux; // import {connect, Provider} from 'react-redux';
          const {createStore, compose} = Redux; // import {createStore} from 'redux';
          const {Component} = React; // import {Component} from 'react';
          const {map} = _; // import {map} from 'lodash'

            const wsUrl = `@wsUrl`;

            class WordCount extends Component {
                constructor(props, context) {
                    super(props, context);
                }

                componentDidMount() {
                    const ws = new WebSocket(wsUrl);
                    ws.onmessage = (event) => {
                        const wordcount = JSON.parse(event.data);
                        console.log(wordcount);
                        if (wordcount.val > this.state.highestVal) {
                            this.setState({
                                highestVal: wordcount.val,
                                wordcounts :  this.state.wordcounts.splice(0, null, wordcount).splice(5)
                            });
                        }
                    };
                }

                /* EVENT HANDLERS */
                updateItem() {
                    this.props.dispatch(updateItemAction())
                }

                render() {

                    const {items, updateItem} = this.props;


                    return (
                    <div>
                        <table>
                          <tbody>
                            {map(items, (item, index) => {
                              return (<tr key={index}>
                                <td>{item.key}</td>
                                <td>{item.val}</td>
                              </tr>);
                            })}
                          </tbody>
                        </table>
                      </div>
                    );
                }
            }

            /* MAP STATE TO PROPS */
              // Probably the most important method of the demo which handles the React/Redux integration.
              // When state changes, this method is called, which then you can use to customly
              // map the state into props that your React component can use
              const mapStateToProps = (state) => {
                return {
                  items: state.items,
                }
              }

              /* ACTION CREATORS */
              // Action creators allow you to communicate with the redux store
              // You always send an object with at minimum a property called `type` aka event name
              // Then send an arbitrary data alongside it
              const updateItemAction = () => {
                return {
                  type: 'UPDATE_ITEM'
                }
              }


              const wordCounterReducer = (state = {items: []}, action) => {
                let items = state.items.slice(); // Nice hack to truely clone an array without reference
                // This is quite a common way of deciding which event to process
                // Note: ALL events will be coming through this reducer
                console.log('Actions', action); // Open your console to see what actions look like
                // Even better, install Redux DevTools and your mind will be blown
                switch (action.type) {
                  case 'UPDATE_ITEM':
                    items.push('') // Add an extra element to items
                    break;
                }
                // As above, we have to return a new state object each time (Redux store is immutable)
                // It makes sure we know our data can only be modified in one visible way
                // Also lets us time travel through our application state!
                const newState = {
                  items: items,
                }
                console.log('Current State', newState);
                return newState;
              }


        </script>

    </body>
</html>
